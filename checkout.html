<!DOCTYPE html>
<html>
<head>
  <title>Checkout</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    // Initialize Supabase
    const supabaseUrl = "https://hnfbwuxoeidsjcamtbgx.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhuZmJ3dXhvZWlkc2pjYW10Ymd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxODM3NzEsImV4cCI6MjA4MDc1OTc3MX0.0ttrpISz2t0EqGy-ndmetP3eWmwfgmQcOAeVWxmUbgw"; // from project settings â†’ API
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    function loadCart() {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      document.getElementById("items").textContent = JSON.stringify(cart, null, 2);
      let total = cart.reduce((sum, item) => sum + item.price, 0);
      document.getElementById("total").textContent = total.toFixed(2);
    }

    async function placeOrder() {
      let tableNumber = document.getElementById("table").value;
      let notes = document.getElementById("notes").value;
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      let total = cart.reduce((sum, item) => sum + item.price, 0);

      if (!tableNumber) { alert("Enter table number"); return; }

      // Save to Supabase
      let { data, error } = await supabase
        .from("orders")
        .insert([{ table_number: tableNumber, items: JSON.stringify(cart), total: total, notes: notes }]);

      if (error) {
        alert("Error placing order: " + error.message);
      } else {
        alert("Order placed successfully!");
        localStorage.removeItem("cart");
        window.location.href = "menu.html";
      }
    }
  </script>
</head>

<body onload="loadCart()">
  <h1>Checkout</h1>

  <pre id="items"></pre>
  <h3>Total: $<span id="total">0.00</span></h3>

  <label>Table Number:</label><br>
  <input type="number" id="table"><br><br>

  <label>Notes (optional):</label><br>
  <textarea id="notes"></textarea><br><br>

  <button onclick="placeOrder()">Place Order</button>
</body>
</html>